<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#x1f310; HTTP&sol;HTTPS &#x670d;&#x52a1;&#x5668;&#x6a21;&#x5757;&#x8bf4;&#x660e;&#x6587;&#x6863;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="-httphttps-æœåŠ¡å™¨æ¨¡å—è¯´æ˜æ–‡æ¡£">ğŸŒ HTTP/HTTPS æœåŠ¡å™¨æ¨¡å—è¯´æ˜æ–‡æ¡£</h1>
<h2 id="by-ç½‘å®‰2201å¸¸å…†é‘«-è®¡ç§‘2205æé›¨è½©"><strong>by ç½‘å®‰2201å¸¸å…†é‘« è®¡ç§‘2205æé›¨è½©</strong></h2>
<h1 id="-é¡¹ç›®åŠŸèƒ½æ€»è§ˆhttphttps-æœåŠ¡å™¨">âœ… é¡¹ç›®åŠŸèƒ½æ€»è§ˆï¼šHTTP/HTTPS æœåŠ¡å™¨</h1>
<h2 id="-å¯åŠ¨ä¸é…ç½®">ğŸš€ å¯åŠ¨ä¸é…ç½®</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> ä» <code>config.yml</code> åŠ è½½é…ç½®é¡¹</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒ IPv4ã€IPv6ã€åŒæ ˆï¼ˆDualStackï¼‰ç›‘å¬</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒ HTTP ä¸ HTTPS ä¸¤ç§åè®®ï¼ˆå¯é€‰å¼€å¯ TLSï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> é…ç½®å¯æ§åˆ¶ï¼š
<ul>
<li>HTTPPort / HTTPSPort</li>
<li>æ˜¯å¦å¯ç”¨ CGIï¼ˆ<code>IsCgi</code>ï¼‰</li>
<li>æœåŠ¡å™¨å·¥ä½œç›®å½•ï¼ˆ<code>Workdir</code>ï¼‰</li>
<li>å¼ºåˆ¶ IPv4ï¼ˆ<code>ForceIPV4</code>ï¼‰</li>
<li>TLS è¯ä¹¦æ–‡ä»¶è·¯å¾„ï¼ˆ<code>CertFile</code> / <code>KeyFile</code>ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="-http-æœåŠ¡æ ¸å¿ƒåŠŸèƒ½">ğŸŒ HTTP æœåŠ¡æ ¸å¿ƒåŠŸèƒ½</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒ HTTP/1.1 åè®®</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒå¸¸è§æ–¹æ³•ï¼šGETã€POSTã€HEAD</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å®ç° Keep-Alive è¿æ¥ä¿æŒæœºåˆ¶</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è¯·æ±‚å¤šè·¯å¹¶å‘å¤„ç†ï¼ˆåŸºäº goroutineï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å“åº”æ”¯æŒåˆ†å—ä¼ è¾“ï¼ˆChunked Transfer Encodingï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è¯·æ±‚è¶…æ—¶ä¸è¿æ¥è¶…æ—¶æ§åˆ¶ï¼ˆDeadlineï¼‰</li>
</ul>
<h2 id="-é™æ€èµ„æºæœåŠ¡">ğŸ“ é™æ€èµ„æºæœåŠ¡</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒé™æ€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶/ç›®å½•ï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è‡ªåŠ¨è§£æ MIME ç±»å‹</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> ç›®å½•æµè§ˆåŠŸèƒ½ï¼ˆå¯åˆ—å‡ºç›®å½•ç»“æ„ï¼‰</li>
</ul>
<h2 id="ï¸-cgi-åŠ¨æ€å†…å®¹æ”¯æŒ">âš™ï¸ CGI åŠ¨æ€å†…å®¹æ”¯æŒ</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒé…ç½® CGI è·¯ç”±</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> ä½¿ç”¨å¤–éƒ¨ç¨‹åºå¤„ç†è¯·æ±‚ï¼Œæ”¯æŒï¼š
<ul>
<li>è®¾ç½® CGI ç¯å¢ƒå˜é‡ï¼ˆå¦‚ REQUEST_METHOD, QUERY_STRINGï¼‰</li>
<li>è¯»å–æ ‡å‡†è¾“å…¥ï¼ˆPOST æ•°æ®ï¼‰</li>
<li>è¾“å‡ºæ ‡å‡†è¾“å‡ºï¼ˆå“åº”æ­£æ–‡ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="-è°ƒè¯•ä¸ç›‘æ§æ¥å£">ğŸ§ª è°ƒè¯•ä¸ç›‘æ§æ¥å£</h2>
<p>é€šè¿‡ <code>/debug</code> è·¯ç”±è®¿é—®ï¼Œæ”¯æŒï¼š</p>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> HTML é¡µé¢å±•ç¤ºå½“å‰æ³¨å†Œçš„æ‰€æœ‰è·¯ç”±</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> JSON æ ¼å¼å±•ç¤ºè·¯ç”±ç»“æ„ï¼ˆç”¨äºè‡ªåŠ¨åŒ–è§£æï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> ç³»ç»Ÿä¿¡æ¯å±•ç¤ºï¼ˆGOOS/GOARCH, CPU, Mem ä½¿ç”¨ç‡ï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å®æ—¶æ—¥å¿—æµè§ˆ</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ—¥å¿—å…³é”®å­—æœç´¢åŠŸèƒ½</li>
</ul>
<h2 id="-è·¯ç”±ç®¡ç†">ğŸ—‚ è·¯ç”±ç®¡ç†</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒåŠ¨æ€è·¯ç”±æ³¨å†Œä¸åŒ¹é…</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> åŒºåˆ†è¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰ä¸è·¯å¾„ï¼ˆPatternï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ¯æ¡è·¯ç”±æ”¯æŒé™„å¸¦æè¿°ï¼ˆç”¨äºè°ƒè¯•é¢æ¿ï¼‰</li>
</ul>
<h2 id="-ä¸­é—´å±‚ä¸è¯·æ±‚å¤„ç†ä¸Šä¸‹æ–‡">ğŸ›  ä¸­é—´å±‚ä¸è¯·æ±‚å¤„ç†ä¸Šä¸‹æ–‡</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ¯ä¸ªè¯·æ±‚å°è£…ä¸º <code>Context</code> ç»“æ„ï¼š
<ul>
<li><code>Request</code>ã€<code>Conn</code>ã€å“åº”è¾“å‡ºç­‰å°è£…</li>
<li>æ”¯æŒ HTML/JSON è¾“å‡ºæ–¹æ³•</li>
</ul>
</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è¯·æ±‚è·¯å¾„åŒ¹é…åè°ƒåº¦ç»™å¯¹åº”çš„ Handler å¤„ç†å™¨</li>
</ul>
<h2 id="-æ—¥å¿—ç³»ç»Ÿ">ğŸªµ æ—¥å¿—ç³»ç»Ÿ</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> ç»ˆç«¯å®æ—¶è¾“å‡ºæ—¥å¿—</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å¯é€‰æŒä¹…åŒ–è‡³æ—¥å¿—æ–‡ä»¶ï¼ˆé»˜è®¤æ¯æ—¥åˆ†å‰²ï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒï¼š
<ul>
<li>å¯åŠ¨æ—¥å¿—ï¼ˆBootï¼‰</li>
<li>è®¿é—®æ—¥å¿—ï¼ˆAccessï¼‰</li>
<li>é”™è¯¯æ—¥å¿—ï¼ˆErrorï¼‰</li>
<li>æ—¥å¿—çº§åˆ«å¯æ§ï¼ˆInfo/Warn/Errorï¼‰</li>
</ul>
</li>
</ul>
<h2 id="-å·¥å…·ä¸è¾…åŠ©åŠŸèƒ½">ğŸ§° å·¥å…·ä¸è¾…åŠ©åŠŸèƒ½</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒ IP ç±»å‹åˆ¤æ–­ï¼ˆIPv4/IPv6ï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è‡ªåŠ¨æ£€æµ‹è·¯å¾„æ˜¯å¦åˆæ³•ï¼ˆé˜²æ­¢ç›®å½•ç©¿è¶Šï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒæ–‡ä»¶ MIME ç±»å‹è¯†åˆ«</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å¯è®¾ç½®æ–‡ä»¶å“åº”æ—¶çš„ Content-Type å’Œ Content-Length</li>
</ul>
<h2 id="-https-ä¸å®‰å…¨æ”¯æŒ">ğŸ” HTTPS ä¸å®‰å…¨æ”¯æŒ</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> å¯å¼€å¯ HTTPSï¼ˆé€šè¿‡é…ç½® EnbaleTLSï¼‰</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> è‡ªå®šä¹‰è¯ä¹¦/ç§é’¥è·¯å¾„</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> æ”¯æŒä»…å¯ç”¨ HTTPS æˆ– HTTP + HTTPS åŒç›‘å¬</li>
</ul>
<h2 id="-é¡¹ç›®æ¨¡å—ç»“æ„æ¦‚è§ˆ">ğŸ§© é¡¹ç›®æ¨¡å—ç»“æ„æ¦‚è§ˆ</h2>
<p>é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å—è·¯å¾„</th>
<th>åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>core/config</code></td>
<td>é…ç½®ç®¡ç†ï¼ˆå¦‚ HTTP/HTTPS ç«¯å£ã€TLS å¼€å…³ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>core/server</code></td>
<td>HTTP(S) æœåŠ¡å™¨ä¸»é€»è¾‘ï¼ŒåŒ…å«ç›‘å¬ã€è°ƒåº¦ã€è¯·æ±‚å¤„ç†ç­‰</td>
</tr>
<tr>
<td><code>core/router</code></td>
<td>è·¯ç”±ç®¡ç†ä¸æ³¨å†Œé€»è¾‘</td>
</tr>
<tr>
<td><code>core/cgi</code></td>
<td>CGI ç¨‹åºè°ƒç”¨ä¸ç®¡ç†</td>
</tr>
<tr>
<td><code>core/log</code> / <code>core/talklog</code></td>
<td>æ—¥å¿—è¾“å‡ºä¸äº‹ä»¶è®°å½•</td>
</tr>
<tr>
<td><code>core/debug</code></td>
<td>è°ƒè¯•é¢æ¿æ¥å£ï¼ˆå¦‚è·¯ç”±æŸ¥çœ‹ã€æ—¥å¿—æœç´¢ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>core/util</code></td>
<td>é€šç”¨å·¥å…·å‡½æ•°ï¼ˆå¦‚æ–‡ä»¶è¯»å–ã€IPæ£€æµ‹ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>cmd/main.go</code></td>
<td>é¡¹ç›®å…¥å£ï¼Œæ ¹æ®é…ç½®å¯åŠ¨æœåŠ¡</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-æ¨¡å—é—´è°ƒç”¨å…³ç³»å›¾æ–‡æœ¬æè¿°">ğŸ” æ¨¡å—é—´è°ƒç”¨å…³ç³»å›¾ï¼ˆæ–‡æœ¬æè¿°ï¼‰</h2>
<pre><code class="language-text">main.go
  â””â”€â”€&gt; core/config               # åŠ è½½é…ç½®
  â””â”€â”€&gt; core/server.StartServer  # å¯åŠ¨æœåŠ¡å™¨ï¼ˆä¼ å…¥è·¯ç”±è¡¨ï¼‰

core/server
  â””â”€â”€&gt; core/router.NewRouter            # åˆå§‹åŒ–è·¯ç”±å™¨
  â””â”€â”€&gt; core/router.Router.Register(...)# æ³¨å†Œå¸¸è§„è·¯ç”±ã€é™æ€è·¯ç”±ã€CGIè·¯ç”±ã€è°ƒè¯•è·¯ç”±
  â””â”€â”€&gt; net.Listen(...)                  # å¯åŠ¨ TCP/HTTPS æœåŠ¡
  â””â”€â”€&gt; core/config.ProtoConfig         # åˆ¤æ–­æ˜¯å¦å¯ç”¨ CGIã€TLSã€DualStack ç­‰
  â””â”€â”€&gt; core/cgi                        # æ‰§è¡Œ CGI è„šæœ¬è¯·æ±‚
  â””â”€â”€&gt; core/util                       # å·¥å…·å‡½æ•°ï¼ˆå¦‚ MIMEã€IPã€è·¯å¾„ï¼‰
  â””â”€â”€&gt; core/talklog.Logger             # æ—¥å¿—è®°å½•

core/debug
  â””â”€â”€&gt; core/router.Router              # è°ƒè¯•é¡µéœ€è®¿é—®æ³¨å†Œè·¯ç”±ç­‰ç»“æ„
  â””â”€â”€&gt; net.Conn (Conn æ¥å£ä¼ å…¥ context) # æ”¯æŒ HTML/JSON ä¸¤ç§æ ¼å¼è¾“å‡º

core/router
  â””â”€â”€&gt; Handler åŒ…                      # handler é€»è¾‘æ¨¡å—æ³¨å†Œï¼Œå¦‚ debugã€cgiã€static
</code></pre>
<hr>
<h2 id="-æ¨¡å—åŠŸèƒ½è¯¦è§£">ğŸ” æ¨¡å—åŠŸèƒ½è¯¦è§£</h2>
<h3 id="1-coreconfig--é…ç½®ç³»ç»Ÿ">1. <code>core/config</code> â€“ é…ç½®ç³»ç»Ÿ</h3>
<ul>
<li>æ”¯æŒä» YAML æ–‡ä»¶è¯»å–å‚æ•°ï¼ˆå¦‚ IPv6 å¼€å…³ã€TLS æ–‡ä»¶è·¯å¾„ç­‰ï¼‰ã€‚</li>
<li>æä¾› <code>ProtoConfig</code> ç»“æ„ä½“æè¿°è¿è¡Œæ¨¡å¼ï¼ˆå¦‚ CGI å¼€å¯ã€å¯ç”¨ TLSï¼‰ã€‚</li>
<li>æ‰€æœ‰é…ç½®å€¼è¢«åŠ è½½åˆ° <code>globalconfig.GlobalConfig</code>ã€‚</li>
</ul>
<h3 id="2-coreserver--ä¸»æœåŠ¡å™¨æ¨¡å—">2. <code>core/server</code> â€“ ä¸»æœåŠ¡å™¨æ¨¡å—</h3>
<p><img src="file:////home/doraemon/Workspace/xjtu_cnlab/assets/server_uml.png" alt="core/server UML"></p>
<ul>
<li>æ”¯æŒ HTTP/1.1 æ ‡å‡†ã€‚</li>
<li>æ”¯æŒï¼š
<ul>
<li><code>GET</code> / <code>POST</code> / <code>HEAD</code> è¯·æ±‚ï¼›</li>
<li>Keep-Aliveï¼›</li>
<li>å¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼›</li>
<li>è·¯ç”±è¡¨è°ƒåº¦ï¼›</li>
<li>CGI æ‰§è¡Œï¼›</li>
<li>HTTPS æ”¯æŒï¼›</li>
<li>IPv4 / IPv6 / DualStackï¼›</li>
</ul>
</li>
<li>ä¸»å…¥å£ <code>StartServer()</code> ä½¿ç”¨é…ç½®å¯åŠ¨ç›‘å¬å™¨ã€‚</li>
</ul>
<h3 id="3-corerouter--è·¯ç”±ç®¡ç†å™¨">3. <code>core/router</code> â€“ è·¯ç”±ç®¡ç†å™¨</h3>
<p><img src="file:////home/doraemon/Workspace/xjtu_cnlab/assets/router_uml.png" alt="router UML"></p>
<ul>
<li>æä¾› <code>Router.Register()</code> ç³»åˆ—å‡½æ•°ç”¨äºæ³¨å†Œä»¥ä¸‹ç±»åˆ«ï¼š
<ul>
<li>é€šç”¨ä¸šåŠ¡é€»è¾‘è·¯ç”±ï¼›</li>
<li>é™æ€æ–‡ä»¶è·¯ç”±ï¼›</li>
<li>è°ƒè¯•è·¯ç”±ï¼›</li>
<li>CGI è·¯ç”±ã€‚</li>
</ul>
</li>
<li>æ”¯æŒè·¯å¾„åŒ¹é…ã€Method åŒ¹é…ç­‰ã€‚</li>
</ul>
<h3 id="4-appdebug--è°ƒè¯•æ¨¡å—">4. <code>app/debug</code> â€“ è°ƒè¯•æ¨¡å—</h3>
<p><img src="file:////home/doraemon/Workspace/xjtu_cnlab/assets/debug_uml.png" alt="debug UML"></p>
<ul>
<li>æä¾› <code>/debug</code> æ¥å£ç»„ï¼Œæ”¯æŒï¼š
<ul>
<li>æŸ¥çœ‹å·²æ³¨å†Œè·¯ç”±ï¼ˆHTML/JSONï¼‰ï¼›</li>
<li>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆå¦‚ CPU/å†…å­˜ï¼‰ï¼›</li>
<li>æ—¥å¿—æ–‡ä»¶å†…å®¹æŸ¥çœ‹ï¼›</li>
<li>æ—¥å¿—æœç´¢åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>é‡‡ç”¨ç‹¬ç«‹ HTML æ¨¡æ¿è¾“å‡ºã€‚</li>
</ul>
<h3 id="5-corecgi--cgi-ç®¡ç†æ¨¡å—">5. <code>core/cgi</code> â€“ CGI ç®¡ç†æ¨¡å—</h3>
<p><img src="file:////home/doraemon/Workspace/xjtu_cnlab/assets/cgi_uml.png" alt="core/cgi"></p>
<ul>
<li>æ”¯æŒ <code>IsCgi</code> é…ç½®ä¸‹å¯ç”¨åŠ¨æ€è„šæœ¬å¤„ç†ã€‚</li>
<li>æ¯ä¸ª <code>.cgi</code> è·¯ç”±ç»‘å®šæ‰§è¡Œ <code>exec.Command(...)</code> å¯åŠ¨ CGI ç¨‹åºã€‚</li>
<li>ç¯å¢ƒå˜é‡ç­‰å‚æ•°æ³¨å…¥å®Œæ•´ã€‚</li>
<li>æ”¯æŒåœ°å€æ˜ å°„ï¼Œè®¿é—®cgiè„šæœ¬æ— é¡»åœ¨urlä¸­åŠ å…¥<code>/cgi-bin</code> or <code>/cgi</code></li>
</ul>
<h3 id="6-coreutil--é€šç”¨å·¥å…·æ¨¡å—">6. <code>core/util</code> â€“ é€šç”¨å·¥å…·æ¨¡å—</h3>
<ul>
<li>æä¾›è·¯å¾„å®‰å…¨å¤„ç†ã€MIME ç±»å‹åˆ¤æ–­ã€IPv4/IPv6 åˆ¤æ–­ã€æ—¶é—´æ ¼å¼ç­‰é€šç”¨å‡½æ•°ã€‚</li>
</ul>
<h3 id="7-corelog--coretalklog--æ—¥å¿—ç³»ç»Ÿ">7. <code>core/log</code> / <code>core/talklog</code> â€“ æ—¥å¿—ç³»ç»Ÿ</h3>
<ul>
<li>æ”¯æŒç»ˆç«¯è¾“å‡º + æ–‡ä»¶å†™å…¥ï¼›</li>
<li>åŒ…å«å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ‰“å°å‡½æ•°ï¼›</li>
<li>debug é¡µé¢å¯æŸ¥è¯¢æ—¥å¿—å†…å®¹ã€‚</li>
</ul>
<hr>
<h2 id="-è¯·æ±‚å¤„ç†æµç¨‹ç®€è¿°">ğŸ§® è¯·æ±‚å¤„ç†æµç¨‹ç®€è¿°</h2>
<pre><code class="language-text">[client request] --&gt; net.Listener (server)
                  --&gt; goroutine å¤„ç†è¿æ¥
                    --&gt; è§£æ HTTP è¯·æ±‚å¤´
                    --&gt; åŒ¹é… router
                      â”œâ”€â”€ é™æ€æ–‡ä»¶
                      â”œâ”€â”€ CGI æ‰§è¡Œ
                      â”œâ”€â”€ æ³¨å†Œå¤„ç†å™¨ï¼ˆå¦‚ debugï¼‰
                    --&gt; è¿”å› HTTP å“åº”
                    --&gt; è®°å½•æ—¥å¿—
</code></pre>
<h2 id=""><img src="file:////home/doraemon/Workspace/xjtu_cnlab/assets/http_server_sequence.png" alt="æœåŠ¡å™¨æ—¶åºå›¾"></h2>
<h2 id="-æ¨¡å—æ‰©å±•å»ºè®®">ğŸ§± æ¨¡å—æ‰©å±•å»ºè®®</h2>
<table>
<thead>
<tr>
<th>ç›®æ ‡</th>
<th>å»ºè®®æ¨¡å—</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ·»åŠ  RESTful æ¥å£</td>
<td><code>core/router</code> + <code>core/handler</code></td>
<td>ç¼–å†™æ–° handlerï¼Œå¹¶é€šè¿‡ Router æ³¨å†Œè·¯å¾„</td>
</tr>
<tr>
<td>æ”¯æŒ HTTP2 / WebSocket</td>
<td><code>core/server</code></td>
<td>æ›´æ¢åº•å±‚ç›‘å¬å™¨æˆ–æ·»åŠ åè®®å‡çº§å¤„ç†</td>
</tr>
<tr>
<td>å¢åŠ ç¼“å­˜/é˜²ç›—é“¾åŠŸèƒ½</td>
<td><code>core/util</code> / <code>server</code> ä¸­æ·»åŠ ä¸­é—´ä»¶</td>
<td>å®ç°ç¼“å­˜æ§åˆ¶å¤´æˆ– IP æ£€æŸ¥</td>
</tr>
<tr>
<td>TLS çƒ­æ›´æ–°è¯ä¹¦</td>
<td><code>core/server</code></td>
<td>ä½¿ç”¨ <code>GetCertificate</code> åŠ¨æ€è¯ä¹¦åŠ è½½</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-æµ‹è¯•ç¤ºä¾‹">ğŸ§ª æµ‹è¯•ç¤ºä¾‹</h2>
<ul>
<li>æ™ºèƒ½åå•†è¿”å›æ ¼å¼ï¼š</li>
</ul>
<pre><code class="language-bash">curl -H <span class="hljs-string">&quot;Accept: application/json&quot;</span> http://localhost:8000/debug/routes
</code></pre>
<ul>
<li>å¼ºåˆ¶å…³é—­è¿æ¥ï¼š</li>
</ul>
<pre><code class="language-bash">curl -H <span class="hljs-string">&quot;Connection: close&quot;</span> -X GET localhost:8000/cgi-bin/test-echo.py
</code></pre>
<hr>
<blockquote>
<p>æ ¸å¿ƒæ¨¡å—æ˜¯ç‹¬ç«‹çš„ã€é€šç”¨çš„ï¼Œä¸šåŠ¡é€»è¾‘æ˜¯å¤–éƒ¨å¯æ’æ‹”çš„ã€‚</p>
</blockquote>

            
            
        </body>
        </html>